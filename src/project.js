window.__require=function e(t,o,n){function r(c,i){if(!o[c]){if(!t[c]){var d=c.split("/");if(d=d[d.length-1],!t[d]){var l="function"==typeof __require&&__require;if(!i&&l)return l(d,!0);if(a)return a(d,!0);throw new Error("Cannot find module '"+c+"'")}}var s=o[c]={exports:{}};t[c][0].call(s.exports,function(e){return r(t[c][1][e]||e)},s,s.exports,e,t,o,n)}return o[c].exports}for(var a="function"==typeof __require&&__require,c=0;c<n.length;c++)r(n[c]);return r}({CardData:[function(e,t,o){"use strict";cc._RF.push(t,"ece67rkl5NBc5Oz3gOnJ1x2","CardData"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){return function(e,t){this.color=e,this.pattern=t}}();o.CardType=n,function(e){e.Red="#ff7675",e.Blue="#0984e3",e.Black="#2d3436",e.Green="#00b894"}(o.Color||(o.Color={})),function(e){e.Gold="Gold",e.Wood="Wood",e.Water="Water",e.Fire="Fire",e.Earth="Earth"}(o.Pattern||(o.Pattern={})),cc._RF.pop()},{}],CardDeck:[function(e,t,o){"use strict";cc._RF.push(t,"c02c31kJ8ZGvolFuggdJn3f","CardDeck"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Card"),r=e("./CardData"),a=e("./NewCards"),c=cc._decorator,i=c.ccclass,d=c.property;o.ANIMATION_TIME=.25;var l=null,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.newCardPanelOpen=!1,t.dragToRemove=null,t.turnCount=0,t.nextTurn=null,t.newCards=null,t._unlockedSquad=0,t._life=100,t._opponentLife=100,t.cardPrefab=null,t.placeholders=null,t.holdingNode=null,t.squadNode=null,t.squadNodeClone=null,t.opponentSquadNode=null,t.holdingAreaLabel=null,t.lifeLabel=null,t.opponentLifeLabel=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"unlockedSquad",{get:function(){return this._unlockedSquad},set:function(e){this.setHoldingAreaLabel(),this.placeholders.children.forEach(function(t,o){t.children[0].active=o>=e}),this._unlockedSquad=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"life",{get:function(){return this._life},set:function(e){this.lifeLabel.string="Life: "+e,this._life=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"opponentLife",{get:function(){return this._opponentLife},set:function(e){this.opponentLifeLabel.string="Opponent's Life: "+e,this._opponentLife=e},enumerable:!0,configurable:!0}),t.getInstance=function(){if(null===l)throw new Error("Placeholders is null, likely due to onLoad execution order");return l},t.prototype.moveToSquad=function(e){return!(this.squadNode.childrenCount>=this._unlockedSquad)&&(e.node.position=this.squadNode.convertToNodeSpaceAR(e.node.parent.convertToWorldSpaceAR(e.node.position)),e.node.parent=this.squadNode,this.rearrangeCards(),!0)},t.prototype.sell=function(e){return e.node.parent=this.node,e.node.destroy(),this.life+=Math.pow(3,e.level-1),this.rearrangeCards(),!0},t.prototype.toggleNextTurn=function(e){this.nextTurn.active=e,this.dragToRemove.active=!e},t.prototype.moveToHolding=function(e){return!(this.holdingNode.childrenCount>=6)&&(e.node.position=this.holdingNode.convertToNodeSpaceAR(e.node.parent.convertToWorldSpaceAR(e.node.position)),e.node.parent=this.holdingNode,this.rearrangeCards(),!0)},t.prototype.addToHolding=function(e){return this.holdingNode.childrenCount>=6?(alert("Holding area is full"),!1):this.life<=2?void alert("You don't have enough lives"):(this.life-=2,e.node.position=this.holdingNode.convertToNodeSpaceAR(e.node.parent.convertToWorldSpaceAR(e.node.position)),e.node.parent=this.holdingNode,e.isNewCard=!1,this.rearrangeCards(),!0)},t.prototype.doNextTurn=function(){var e=this;if(this.squadNode.childrenCount<this.unlockedSquad)alert("Your have empty battle card slots, drag more cards from holding area");else{this.turnCount++,this.opponentLife-=cc.randf(Math.floor(.05*this.opponentLife),Math.floor(.15*this.opponentLife));for(var t=[],a=0;a<Math.min(2+this.turnCount,8);a++)t.push(new r.CardType(r.Color[Object.keys(r.Color).randOne()],r.Pattern[Object.keys(r.Pattern).randOne()]));var c={};this.opponentSquadNode.removeAllChildren(),t.forEach(function(o,r){var a=cc.instantiate(e.cardPrefab),i=a.getComponent(n.default);i.build(o),i.isOpponentCard=!0,a.parent=e.opponentSquadNode,a.x=e.getCardX(t.length,r),c[i.card.color]?c[i.card.color].push(i):c[i.card.color]=[i],c[i.card.pattern]?c[i.card.pattern].push(i):c[i.card.pattern]=[i]});var i={};this.squadNodeClone.removeAllChildren(),this.squadNode.children.forEach(function(t){var o=cc.instantiate(e.cardPrefab),r=o.getComponent(n.default),a=t.getComponent(n.default);r.build(a.card,a.level),o.parent=e.squadNodeClone,o.position=t.position,i[r.card.color]?i[r.card.color].push(r):i[r.card.color]=[r],i[r.card.pattern]?i[r.card.pattern].push(r):i[r.card.pattern]=[r]}),Object.keys(i).forEach(function(e){i[e].length>=3&&i[e].forEach(function(e){e.level>=4||(e.level++,e.playUpgradeAnimation(0))})}),Object.keys(c).forEach(function(e){c[e].length>=3&&c[e].forEach(function(e){e.level>=4||(e.level++,e.playUpgradeAnimation(0))})}),this.opponentSquadNode.parent.active=!0,this.squadNode.active=!1;var d=this.squadNodeClone.children.map(function(e){return e.getComponent(n.default)}),l=this.opponentSquadNode.children.map(function(e){return e.getComponent(n.default)}),s=function(){if(d.length<=0||l.length<=0){e.unschedule(s);var t=2*(d.reduce(function(e,t){return e+t.level},0)-l.reduce(function(e,t){return e+t.level},0));return e.opponentSquadNode.parent.active=!1,e.squadNodeClone.removeAllChildren(),e.squadNode.active=!0,t>0?(alert("You have killed opponent "+Math.abs(t)+" lives"),e.opponentLife-=t):t<0?(alert("You have lost "+Math.abs(t)+" lives"),e.life+=t):alert("It's a tie!"),void e.scheduleOnce(function(){return e.opponentLife<=0?(alert("You have won!"),void cc.director.loadScene("Main")):e.life<=0?(alert("You have lost!"),void cc.director.loadScene("Main")):void e.newCards.openPanel({freeReroll:!0})},.5)}var n=l[0],r=d[0];r.node.runAction(cc.sequence(cc.moveTo(o.ANIMATION_TIME,r.node.parent.convertToNodeSpaceAR(n.node.getWorldPosition()).sub(cc.v2(0,50))).easing(cc.easeInOut(3)),cc.moveTo(o.ANIMATION_TIME,r.node.position).easing(cc.easeInOut(3)),cc.callFunc(function(){var e=Math.min(r.level,n.level);r.level-=e,n.level-=e,r.level<=0&&d.shift(),n.level<=0&&l.shift()})))};this.schedule(s,3*o.ANIMATION_TIME,cc.macro.REPEAT_FOREVER)}},t.prototype.mergeCards=function(){for(var e=this,t=!0,o=function(){t=!1;var o={};r.squadNode.children.concat(r.holdingNode.children).forEach(function(e){var t=e.getComponent(n.default);o[t.card.color+t.card.pattern+t.level]?o[t.card.color+t.card.pattern+t.level].push(t):o[t.card.color+t.card.pattern+t.level]=[t]}),Object.keys(o).forEach(function(n){o[n].length>=3&&o[n][0].level<4&&(o[n][0].level++,o[n][0].playUpgradeAnimation(),o[n][1].node.parent=e.node,o[n][1].node.destroy(),o[n][2].node.parent=e.node,o[n][2].node.destroy(),t=!0)})},r=this;t;)o();this.rearrangeCards()},t.prototype.turnInProgress=function(){return this.opponentSquadNode.parent.active},t.prototype.onLoad=function(){l=this},t.prototype.start=function(){this.unlockedSquad=3,this.life=100,this.opponentLife=100},t.prototype.setHoldingAreaLabel=function(){this.holdingAreaLabel.string="Holding Area "+this.holdingNode.childrenCount+"/6"},t.prototype.rearrangeCards=function(){this.rearrangeSquad(),this.rearrangeHolding()},t.prototype.rearrangeHolding=function(){var e=this;this.setHoldingAreaLabel(),this.holdingNode.children.forEach(function(t,n){t.stopAllActions(),t.scale=1,t.runAction(cc.moveTo(o.ANIMATION_TIME,e.getCardX(e.holdingNode.childrenCount,n),0))})},t.prototype.rearrangeSquad=function(){var e=this;this.squadNode.children.forEach(function(t,n){t.stopAllActions(),t.scale=1,t.runAction(cc.moveTo(o.ANIMATION_TIME,e.placeholders.children[n].position))})},t.prototype.getCardX=function(e,t){var o=cc.winSize.width-60;return 1===e?105:30+((o-150*e)/(e-1)+150)*t+75},__decorate([d(cc.Node)],t.prototype,"dragToRemove",void 0),__decorate([d(cc.Node)],t.prototype,"nextTurn",void 0),__decorate([d(a.default)],t.prototype,"newCards",void 0),__decorate([d(cc.Prefab)],t.prototype,"cardPrefab",void 0),__decorate([d(cc.Node)],t.prototype,"placeholders",void 0),__decorate([d(cc.Node)],t.prototype,"holdingNode",void 0),__decorate([d(cc.Node)],t.prototype,"squadNode",void 0),__decorate([d(cc.Node)],t.prototype,"squadNodeClone",void 0),__decorate([d(cc.Node)],t.prototype,"opponentSquadNode",void 0),__decorate([d(cc.Label)],t.prototype,"holdingAreaLabel",void 0),__decorate([d(cc.Label)],t.prototype,"lifeLabel",void 0),__decorate([d(cc.Label)],t.prototype,"opponentLifeLabel",void 0),t=__decorate([i],t)}(cc.Component);o.default=s,cc._RF.pop()},{"./Card":"Card","./CardData":"CardData","./NewCards":"NewCards"}],Card:[function(e,t,o){"use strict";cc._RF.push(t,"7001aXdrktLFZG86olekLU1","Card"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./CardDeck"),r=cc._decorator,a=r.ccclass,c=r.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.card=null,t.isNewCard=!1,t.isOpponentCard=!1,t.level1=null,t.level2=null,t.level3=null,t.level4=null,t.pattern=null,t.tileFrame=null,t.previousPosition=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},set:function(e){this._level=e,this.level1.active=this._level>=1,this.level2.active=this._level>=2,this.level3.active=this._level>=3,this.level4.active=this._level>=4},enumerable:!0,configurable:!0}),t.prototype.playUpgradeAnimation=function(e){var t=this;void 0===e&&(e=n.ANIMATION_TIME),this.scheduleOnce(function(){t.node.runAction(cc.sequence(cc.scaleTo(.25,1.1),cc.scaleTo(.25,1),cc.scaleTo(.25,1.1),cc.scaleTo(.25,1),cc.scaleTo(.25,1.1),cc.scaleTo(.25,1)))},e)},t.prototype.build=function(e,t){var o=this;void 0===t&&(t=1),this.card=e;var n=cc.color().fromHEX(this.card.color),r="characters/"+e.pattern.replace(" ","-");cc.loader.loadRes(r,cc.SpriteFrame,function(e,t){o.pattern.spriteFrame=t,o.pattern.node.color=n}),this.level=t,this.level4.color=n,this.level3.color=n,this.level2.color=n,this.level1.color=n,this.tileFrame.color=n},t.prototype.start=function(){var e=this;this.node.on(cc.Node.EventType.TOUCH_START,function(t){if(!e.isOpponentCard&&!n.default.getInstance().turnInProgress())if(e.isNewCard){if(!n.default.getInstance().newCardPanelOpen)return;n.default.getInstance().addToHolding(e)}else{if(n.default.getInstance().newCardPanelOpen)return;n.default.getInstance().toggleNextTurn(!1),e.previousPosition=e.node.position}}),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){n.default.getInstance().newCardPanelOpen||e.isNewCard||e.isOpponentCard||n.default.getInstance().turnInProgress()||(e.node.position=e.node.parent.convertToNodeSpaceAR(t.getLocation()))}),this.node.on(cc.Node.EventType.TOUCH_END,function(t){if(!(n.default.getInstance().newCardPanelOpen||e.isNewCard||e.isOpponentCard||n.default.getInstance().turnInProgress())){n.default.getInstance().toggleNextTurn(!0);var o=n.default.getInstance().dragToRemove,r=e.node.parent.convertToNodeSpaceAR(o.getWorldPosition()).y-o.height/2;e.node.position.y>r?n.default.getInstance().sell(e):e.node.position.y>e.previousPosition.y?n.default.getInstance().moveToSquad(e)||(e.node.position=e.previousPosition):n.default.getInstance().moveToHolding(e)||(e.node.position=e.previousPosition)}})},__decorate([c(cc.Node)],t.prototype,"level1",void 0),__decorate([c(cc.Node)],t.prototype,"level2",void 0),__decorate([c(cc.Node)],t.prototype,"level3",void 0),__decorate([c(cc.Node)],t.prototype,"level4",void 0),__decorate([c(cc.Sprite)],t.prototype,"pattern",void 0),__decorate([c(cc.Node)],t.prototype,"tileFrame",void 0),t=__decorate([a],t)}(cc.Component);o.default=i,cc._RF.pop()},{"./CardDeck":"CardDeck"}],Extensions:[function(e,t,o){"use strict";cc._RF.push(t,"2af18SXbdRObJeNEmDHF3zk","Extensions"),Number.prototype.round=function(e){return Math.round(this*Math.pow(10,e))/Math.pow(10,e)},Array.prototype.randOne=function(){return this[Math.floor(this.length*Math.random())]},Array.prototype.shuffle=function(){for(var e,t=this.length-1;t>0;t--){var o=Math.floor(Math.random()*(t+1));e=[this[o],this[t]],this[t]=e[0],this[o]=e[1]}return this},Array.prototype.uniq=function(){return this.filter(function(e,t,o){return o.indexOf(e)===t})},cc.Node.prototype.getWorldPosition=function(){return this.parent.convertToWorldSpaceAR(this.getPosition())},cc.Node.prototype.angelTo=function(e){var t=e.sub(this.getWorldPosition());return 180*Math.atan2(t.x,t.y)/Math.PI},cc.Node.prototype.getAttr=function(e){return this[e]},cc.spriteFrameFromBase64=function(e){return new Promise(function(t,o){var n=new Image;n.src=e,n.onload=function(){var e=new cc.Texture2D;e.initWithElement(n),e.handleLoadedTexture();var o=new cc.SpriteFrame(e);t(o)}})},cc.takeScreenshot=function(){return new Promise(function(e,t){cc.director.on(cc.Director.EVENT_AFTER_DRAW,function(){var t=cc.game.canvas.toDataURL();cc.director.off(cc.Director.EVENT_AFTER_DRAW),e(t)})})},cc.randf=function(e,t){return e+Math.round(t*Math.random())},cc.hasScene=function(e){for(var t=0,o=cc.game.config.scenes;t<o.length;t++){if(o[t].url.endsWith(e+".fire"))return!0}return!1},cc.Graphics&&(cc.Graphics.prototype.dashedLine=function(e,t,o,n){void 0===o&&(o=10),void 0===n&&(n=20);var r=e,a=0,c=t.sub(e);if(!(c.mag()<10))for(var i=c.normalize();(t.x-r.x)*i.x>=0&&(t.y-r.y)*i.y>=0;)a%2==0?(this.moveTo(r.x,r.y),r=r.add(i.mul(o))):(this.lineTo(r.x,r.y),r=r.add(i.mul(n))),a++}),cc._RF.pop()},{}],NewCards:[function(e,t,o){"use strict";cc._RF.push(t,"d7cdeyvwR1C7Kb+grLzzZJz","NewCards"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./Card"),r=e("./CardData"),a=e("./CardDeck"),c=cc._decorator,i=c.ccclass,d=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.panel=null,t.placeholders=null,t.cards=null,t.cardPrefab=null,t}return __extends(t,e),t.prototype.closePanel=function(){a.default.getInstance().newCardPanelOpen=!1,this.panel.active=!1,a.default.getInstance().mergeCards()},t.prototype.openPanel=function(e){var t=e.freeReroll,o=void 0!==t&&t;o&&this.reroll({free:o}),a.default.getInstance().newCardPanelOpen=!0,this.panel.active=!0},t.prototype.start=function(){this.openPanel({freeReroll:!0})},t.prototype.reroll=function(e){var t=this,o=e.free;if(!(void 0!==o&&o)){if(a.default.getInstance().life<=2)return void alert("You don't have enough lives");a.default.getInstance().life-=2}this.cards.removeAllChildren(),this.placeholders.children.forEach(function(e){var o=cc.instantiate(t.cardPrefab),a=o.getComponent(n.default);a.build(new r.CardType(r.Color[Object.keys(r.Color).randOne()],r.Pattern[Object.keys(r.Pattern).randOne()])),o.parent=t.cards,o.position=e.position,a.isNewCard=!0})},__decorate([d(cc.Node)],t.prototype,"panel",void 0),__decorate([d(cc.Node)],t.prototype,"placeholders",void 0),__decorate([d(cc.Node)],t.prototype,"cards",void 0),__decorate([d(cc.Prefab)],t.prototype,"cardPrefab",void 0),t=__decorate([i],t)}(cc.Component);o.default=l,cc._RF.pop()},{"./Card":"Card","./CardData":"CardData","./CardDeck":"CardDeck"}],Overlay:[function(e,t,o){"use strict";cc._RF.push(t,"7ba05zRyipDw6VDR87kyrJb","Overlay"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.text=null,t}return __extends(t,e),t.prototype.closeOverlay=function(){this.node.active=!1},t.prototype.openOverlay=function(e){this.text.string=e,this.node.active=!0},__decorate([a(cc.Label)],t.prototype,"text",void 0),t=__decorate([r],t)}(cc.Component);o.default=c,cc._RF.pop()},{}],Placeholders:[function(e,t,o){"use strict";cc._RF.push(t,"58018NhY2JPyp2jgjJxXphb","Placeholders"),Object.defineProperty(o,"__esModule",{value:!0});var n=e("./CardDeck"),r=cc._decorator,a=r.ccclass,c=(r.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(){var e=n.default.getInstance();this.node.children.forEach(function(t,o){t.on(cc.Node.EventType.TOUCH_START,function(t){if(o>=e.unlockedSquad){var r=Math.pow(2,o-1)-n.default.getInstance().turnCount,a=Math.max(2,r);if(e.life<=a)return void alert("You don't have enough lives");confirm("Unlock this slot with "+a+" lives?")&&(e.unlockedSquad++,e.life-=a)}})})},t=__decorate([a],t)}(cc.Component));o.default=c,cc._RF.pop()},{"./CardDeck":"CardDeck"}]},{},["Card","CardData","CardDeck","Extensions","NewCards","Overlay","Placeholders"]);